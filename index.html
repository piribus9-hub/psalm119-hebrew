<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- PWA 설치를 위한 메타 태그 -->
    <meta name="theme-color" content="#4F46E5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="시편119">
    <meta name="description" content="시편 119편 히브리어 단어별 학습 앱">
    <title>시편 119편 히브리어 학습</title>

    <!-- PWA Manifest와 Icon Data URL을 인라인으로 정의 -->
    <link rel="manifest" id="manifest-pwa">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='75' font-size='80'%3E📖%3C/text%3E%3C/svg%3E">
    
    <!-- Tailwind CSS 및 React 라이브러리 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide-react@latest"></script>

    <style>
        body {
            overscroll-behavior: none;
            -webkit-overflow-scrolling: touch;
            font-family: 'Inter', sans-serif;
        }
        * {
            -webkit-tap-highlight-color: transparent;
        }
        /* 히브리어 폰트 스타일 */
        .hebrew-text {
            font-family: 'David', 'Ezra SIL', 'Times New Roman', serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // React Component와 Logic (Psalm119HebrewLearner.jsx의 내용)

        const { useState, useMemo, useEffect } = React;
        // [수정된 부분]: UMD 번들에서 'lucide' 대신 'LucideReact' 글로벌 변수를 사용하는 경우가 많으므로 변경했습니다.
        // 이는 'ReferenceError'와 'forwardRef' 관련 TypeError를 해결하는 데 도움이 됩니다.
        const { ChevronLeft, ChevronRight, BookOpen, X, Home } = LucideReact; 

        // --- 데이터 정의 (시편 119편의 일부 절만 포함) ---
        const PSALM_119_DATA = [
          // Stanza 1: Aleph (א) - Verses 1-8
          {
            hebrewLetter: "א (Aleph)",
            startVerse: 1,
            endVerse: 8,
            verses: [
              {
                verse: 1,
                hebrew: "אַשְׁרֵי תְמִימֵי־דָרֶךְ הַהֹלְכִים בְּתוֹרַת יְהוָה׃",
                translation: "행위가 온전하여 여호와의 율법을 따라 행하는 자들은 복이 있음이여.",
                words: [
                  { h: "אַשְׁרֵי", t: "Ashrei", m: "복이 있는", r: "Interjection" },
                  { h: "תְמִימֵי־דָרֶךְ", t: "temimei-darekh", m: "길이 온전한 자들", r: "Noun phrase" },
                  { h: "הַהֹלְכִים", t: "hahol'khim", m: "걷는 자들", r: "Verb (Piel Participle)" },
                  { h: "בְּתוֹרַת", t: "b'torat", m: "율법 안에", r: "Noun (Torah)" },
                  { h: "יְהוָה", t: "YHWH", m: "여호와", r: "Proper Noun" }
                ]
              },
              {
                verse: 2,
                hebrew: "אַשְׁרֵי שֹׁמְרֵי עֵדֹתָיו בְּכָל־לֵב יִדְרְשׁוּהוּ׃",
                translation: "여호와의 증거들을 지키고 전심으로 여호와를 구하는 자들은 복이 있도다.",
                words: [
                  { h: "אַשְׁרֵי", t: "Ashrei", m: "복이 있는", r: "Interjection" },
                  { h: "שֹׁמְרֵי", t: "shom'rei", m: "지키는 자들", r: "Verb (Qal Participle)" },
                  { h: "עֵדֹתָיו", t: "edotav", m: "그의 증거들", r: "Noun" },
                  { h: "בְּכָל־לֵב", t: "b'khol-lev", m: "온 마음으로", r: "Prepositional Phrase" },
                  { h: "יִדְרְשׁוּהוּ", t: "yidr'shuhu", m: "그를 구하는", r: "Verb (Qal Imperfect)" }
                ]
              },
              {
                verse: 3,
                hebrew: "אַף לֹא־פָעֲלוּ עַוְלָה בִּדְרָכָיו הָלָכוּ׃",
                translation: "또 저희는 불의를 행치 아니하고 그의 도를 행하는도다.",
                words: [
                  { h: "אַף", t: "Af", m: "또한", r: "Adverb" },
                  { h: "לֹא־פָעֲלוּ", t: "lo-fa'alu", m: "행하지 않았다", r: "Verb (Qal Perfect)" },
                  { h: "עַוְלָה", t: "avlah", m: "불의", r: "Noun" },
                  { h: "בִּדְרָכָיו", t: "bidrakhav", m: "그의 길에서", r: "Prepositional Phrase" },
                  { h: "הָלָכוּ", t: "halakhu", m: "그들이 걸었다", r: "Verb (Qal Perfect)" }
                ]
              },
              {
                verse: 4,
                hebrew: "אַתָּה צִוִּיתָה פִקֻּדֶיךָ לִשְׁמֹר מְאֹד׃",
                translation: "주께서 명령하사 주의 법도를 열심히 지키게 하셨나이다.",
                words: [
                  { h: "אַתָּה", t: "Atah", m: "주께서", r: "Pronoun" },
                  { h: "צִוִּיתָה", t: "tzivvita", m: "명령하셨다", r: "Verb (Piel Perfect)" },
                  { h: "פִקֻּדֶיךָ", t: "pikkudeikha", m: "주의 법도", r: "Noun" },
                  { h: "לִשְׁמֹר", t: "lishmor", m: "지키도록", r: "Verb (Qal Infinitive)" },
                  { h: "מְאֹד", t: "me'od", m: "심히", r: "Adverb" }
                ]
              },
              {
                verse: 5,
                hebrew: "אַחֲלַי כִּי־יִכֹּנוּ דְרָכָי לִשְׁמֹר חֻקֶּיךָ׃",
                translation: "내 길을 정돈하사 주의 율례를 지키게 하소서.",
                words: [
                  { h: "אַחֲלַי", t: "Aḥalai", m: "오! 그랬으면", r: "Interjection" },
                  { h: "כִּי־יִכֹּנוּ", t: "ki-yikonu", m: "내 길이 굳게 서서", r: "Conjunction + Verb" },
                  { h: "דְרָכָי", t: "d'rakhai", m: "나의 길들", r: "Noun" },
                  { h: "לִשְׁמֹר", t: "lishmor", m: "지키도록", r: "Verb (Qal Infinitive)" },
                  { h: "חֻקֶּיךָ", t: "ḥuqqeikha", m: "주의 율례", r: "Noun" }
                ]
              },
              {
                verse: 6,
                hebrew: "אָז לֹא אֵבוֹשׁ בְּהַבִּיטִי אֶל־כָּל־מִצְוֹתֶיךָ׃",
                translation: "내가 주의 모든 계명에 주의할 때에는 부끄럽지 아니하리이다.",
                words: [
                  { h: "אָז", t: "Az", m: "그 때에", r: "Adverb" },
                  { h: "לֹא", t: "lo", m: "아니다", r: "Negative Particle" },
                  { h: "אֵבוֹשׁ", t: "evosh", m: "부끄럽지 않으리", r: "Verb (Qal Imperfect)" },
                  { h: "בְּהַבִּיטִי", t: "b'habbiti", m: "내가 볼 때", r: "Preposition + Verb" },
                  { h: "אֶל־כָּל־מִצְוֹתֶיךָ", t: "el-kol-mitzvoteikha", m: "주의 모든 계명", r: "Prepositional Phrase" }
                ]
              },
              {
                verse: 7,
                hebrew: "אוֹדְךָ בְּיֹשֶׁר לֵבָב בְּלָמְדִי מִשְׁפְּטֵי צִדְקֶךָ׃",
                translation: "내가 주의 의로운 판단을 배울 때에는 정직한 마음으로 주께 감사하리이다.",
                words: [
                  { h: "אוֹדְךָ", t: "Od'kha", m: "내가 주께 감사하리", r: "Verb (Hiphil Imperfect)" },
                  { h: "בְּיֹשֶׁר", t: "b'yosher", m: "정직함으로", r: "Preposition + Noun" },
                  { h: "לֵבָב", t: "levav", m: "마음", r: "Noun" },
                  { h: "בְּלָמְדִי", t: "b'lomdi", m: "내가 배울 때", r: "Preposition + Verb" },
                  { h: "מִשְׁפְּטֵי", t: "mishp'tei", m: "판단들", r: "Noun" },
                  { h: "צִדְקֶךָ", t: "tzid'qekha", m: "주의 의", r: "Noun" }
                ]
              },
              {
                verse: 8,
                hebrew: "אֶת־חֻקֶּיךָ אֶשְׁמֹר אַל־תַּעַזְבֵנִי עַד־מְאֹד׃",
                translation: "내가 주의 율례들을 지키오리니 나를 아주 버리지 마옵소서.",
                words: [
                  { h: "אֶת־חֻקֶּיךָ", t: "et-ḥuqqeikha", m: "주의 율례를", r: "Object Marker + Noun" },
                  { h: "אֶשְׁמֹר", t: "esh'mor", m: "내가 지키리", r: "Verb (Qal Imperfect)" },
                  { h: "אַל־תַּעַזְבֵנִי", t: "al-ta'azveni", m: "나를 버리지 마소서", r: "Negative Particle + Verb (Qal Imperfect)" },
                  { h: "עַד־מְאֹד", t: "ad-m'od", m: "심히(완전히)", r: "Prepositional Phrase" }
                ]
              },
            ]
          },
          // Stanza 2: Bet (ב) - Verses 9-16
          {
            hebrewLetter: "ב (Bet)",
            startVerse: 9,
            endVerse: 16,
            verses: [
              {
                verse: 9,
                hebrew: "בַּמֶּה יְזַכֶּה־נַּעַר אֶת־אֹרְחוֹ לִשְׁמֹר כִּדְבָרֶךָ׃",
                translation: "청년이 무엇으로 그 행실을 깨끗케 하리이까 주의 말씀을 따라 삼갈 것이니이다.",
                words: [
                  { h: "בַּמֶּה", t: "Bameh", m: "무엇으로", r: "Interrogative" },
                  { h: "יְזַכֶּה־נַּעַר", t: "yezakeh-na'ar", m: "청년이 깨끗하게 할까요", r: "Verb (Piel Imperfect) + Noun" },
                  { h: "אֶת־אֹרְחוֹ", t: "et-orḥo", m: "그의 길", r: "Object Marker + Noun" },
                  { h: "לִשְׁמֹר", t: "lishmor", m: "지키도록", r: "Verb (Qal Infinitive)" },
                  { h: "כִּדְבָרֶךָ", t: "kidvarekha", m: "주의 말씀대로", r: "Prepositional Phrase" }
                ]
              },
              {
                verse: 10,
                hebrew: "בְּכָל־לִבִּי דְרַשְׁתִּיךָ אַל־תַּשְׁגֵּנִי מִמִּצְוֹתֶיךָ׃",
                translation: "내가 전심으로 주를 찾았사오니 주의 계명에서 떠나지 말게 하소서.",
                words: [
                  { h: "בְּכָל־לִבִּי", t: "B'khol-libi", m: "나의 온 마음으로", r: "Prepositional Phrase" },
                  { h: "דְרַשְׁתִּיךָ", t: "d'rashtikha", m: "내가 주를 찾았다", r: "Verb (Qal Perfect)" },
                  { h: "אַל־תַּשְׁגֵּנִי", t: "al-tash'geni", m: "내가 떠나게 하지 마소서", r: "Negative Particle + Verb (Hiphil Imperfect)" },
                  { h: "מִמִּצְוֹתֶיךָ", t: "mimit͡svoteikha", m: "주의 계명으로부터", r: "Prepositional Phrase" }
                ]
              }
            ]
          },
        ];

        // --- 유틸리티 함수 ---
        const findVerseByNumber = (verseNum) => {
          for (const stanza of PSALM_119_DATA) {
            for (const verse of stanza.verses) {
              if (verse.verse === verseNum) {
                return verse;
              }
            }
          }
          return PSALM_119_DATA[0].verses[0];
        };

        // --- 컴포넌트: 단어 상세 모달 ---
        const WordDetailModal = ({ selectedWord, onClose }) => {
          if (!selectedWord) return null;

          return (
            <div 
              className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 transition-opacity duration-300"
              onClick={onClose}
            >
              <div 
                className="bg-white rounded-xl shadow-2xl w-full max-w-sm p-6 transform transition-all duration-300 scale-100"
                onClick={e => e.stopPropagation()}
              >
                <div className="flex justify-between items-start border-b pb-3 mb-4">
                  <h3 className="text-3xl font-bold text-gray-800 hebrew-text" dir="rtl">{selectedWord.h}</h3>
                  <button onClick={onClose} className="p-1 rounded-full text-gray-500 hover:bg-gray-100">
                    <X size={24} />
                  </button>
                </div>

                <div className="space-y-3">
                  <div className="p-3 bg-gray-50 rounded-lg">
                    <p className="text-xs font-semibold text-gray-600 mb-1">음역 (Transliteration)</p>
                    <p className="text-lg font-mono text-indigo-700">{selectedWord.t}</p>
                  </div>
                  
                  <div className="p-3 bg-gray-50 rounded-lg">
                    <p className="text-xs font-semibold text-gray-600 mb-1">의미 (Meaning)</p>
                    <p className="text-lg text-gray-800">{selectedWord.m}</p>
                  </div>

                  <div className="p-3 bg-gray-50 rounded-lg">
                    <p className="text-xs font-semibold text-gray-600 mb-1">품사/구조 (Part of Speech)</p>
                    <p className="text-base text-gray-700">{selectedWord.r}</p>
                  </div>
                </div>

                <button 
                  onClick={onClose} 
                  className="mt-6 w-full py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition-colors active:bg-indigo-800"
                >
                  닫기
                </button>
              </div>
            </div>
          );
        };


        // --- 컴포넌트: 메인 앱 ---
        const App = () => {
          const [currentVerseNum, setCurrentVerseNum] = useState(1);
          const [selectedWord, setSelectedWord] = useState(null);

          // 현재 절 정보를 메모이제이션
          const currentVerse = useMemo(() => findVerseByNumber(currentVerseNum), [currentVerseNum]);
          
          // 현재 Stanza 정보
          const currentStanza = useMemo(() => 
            PSALM_119_DATA.find(s => s.startVerse <= currentVerseNum && s.endVerse >= currentVerseNum) || PSALM_119_DATA[0]
          , [currentVerseNum]);

          // 마지막 절 번호 (현재 데이터 범위)
          const lastAvailableVerse = 10;

          // 단어 클릭 핸들러
          const handleWordClick = (word) => {
            setSelectedWord(word);
          };

          // 다음/이전 절 이동
          const navigateVerse = (direction) => {
            const nextVerseNum = currentVerseNum + direction;
            if (nextVerseNum >= 1 && nextVerseNum <= lastAvailableVerse) {
              setCurrentVerseNum(nextVerseNum);
            }
          };

          // 렌더링을 위해 히브리어 텍스트를 단어 배열로 분리 (단어별 띄어쓰기 기준으로만 단순 분리)
          const hebrewWords = useMemo(() => {
              const text = currentVerse.hebrew;
              const dataWords = currentVerse.words;
              
              // 띄어쓰기, 구두점을 포함하여 텍스트를 분리 (React의 인라인 요소로 만듦)
              const segments = text.split(/([ \u0590-\u05FF]+)/).filter(s => s.length > 0);
              
              let wordIndex = 0;
              return segments.map((segment, index) => {
                  // 히브리어 단어이거나 단어 + 구두점인 경우 (단어 객체와 매핑)
                  if (segment.match(/[\u0590-\u05FF]/) && !segment.trim().match(/^[ \u0590-\u05FF]+$/)) { 
                      const wordData = dataWords[wordIndex];
                      wordIndex++;

                      if (wordData) {
                          return (
                              <span
                                  key={index}
                                  className="inline-block mx-1 py-1 px-2 rounded-lg cursor-pointer transition-all duration-200 hover:bg-yellow-100 hover:shadow-md active:scale-95 text-gray-900"
                                  onClick={() => handleWordClick(wordData)}
                              >
                                  {wordData.h}
                              </span>
                          );
                      }
                  }
                  // 공백, 구두점, 기타 세그먼트 처리
                  return <span key={index} className="inline-block mx-0.5">{segment}</span>;
              }).filter(Boolean);
          }, [currentVerse]);


          return (
            <div className="min-h-screen bg-gray-50 flex flex-col font-sans">
              
              {/* 상단 헤더 */}
              <header className="bg-indigo-600 text-white shadow-lg p-4 sticky top-0 z-10">
                <div className="flex justify-between items-center max-w-2xl mx-auto">
                  <div className="flex items-center space-x-2">
                    <BookOpen size={24} />
                    <h1 className="text-xl font-bold">시편 119편 히브리어 학습</h1>
                  </div>
                  <button 
                    className="p-2 rounded-full bg-indigo-700 hover:bg-indigo-800 transition-colors active:bg-indigo-900"
                    onClick={() => setCurrentVerseNum(1)}
                    title="첫 절로 이동"
                  >
                    <Home size={20} />
                  </button>
                </div>
              </header>

              {/* 메인 콘텐츠 영역 */}
              <main className="flex-grow p-4 max-w-2xl mx-auto w-full pb-20">
                
                {/* 절 정보 카드 */}
                <div className="bg-white rounded-xl shadow-xl p-5 mb-6 border-t-4 border-indigo-500">
                  
                  <p className="text-sm font-semibold text-indigo-500 mb-2">
                    연(Stanza): {currentStanza.hebrewLetter} | 현재 절: <span className="text-2xl font-extrabold text-indigo-700">{currentVerseNum}</span>절 (총 176절 중)
                  </p>

                  <h2 
                    className="text-4xl sm:text-5xl text-right my-4 leading-relaxed font-serif text-gray-900 hebrew-text" 
                    dir="rtl"
                  >
                    {hebrewWords}
                  </h2>

                  <div className="mt-5 pt-4 border-t border-gray-100">
                    <p className="text-xs font-semibold text-gray-500">개역개정 번역 (Korean Translation)</p>
                    <p className="text-base text-gray-700 leading-relaxed mt-1">
                      {currentVerse.translation}
                    </p>
                  </div>
                  
                </div>

                {/* 네비게이션 버튼 */}
                <div className="flex justify-between items-center space-x-4">
                  <button 
                    onClick={() => navigateVerse(-1)} 
                    disabled={currentVerseNum <= 1}
                    className="flex items-center justify-center w-full py-3 bg-gray-200 text-gray-700 font-bold rounded-lg shadow-md hover:bg-gray-300 disabled:opacity-50 transition-all active:bg-gray-400"
                    aria-label="이전 절"
                  >
                    <ChevronLeft size={20} className="mr-1" /> 이전 절
                  </button>
                  
                  <button 
                    onClick={() => navigateVerse(1)} 
                    disabled={currentVerseNum >= lastAvailableVerse}
                    className="flex items-center justify-center w-full py-3 bg-indigo-500 text-white font-bold rounded-lg shadow-md hover:bg-indigo-600 disabled:opacity-50 transition-all active:bg-indigo-700"
                    aria-label="다음 절"
                  >
                    다음 절 <ChevronRight size={20} className="ml-1" />
                  </button>
                </div>

                <p className="text-center text-xs text-gray-400 mt-4">
                    단어를 탭(터치)하면 상세 정보가 팝업됩니다. (현재 1~10절 데이터만 포함됨)
                </p>
              </main>

              {/* 단어 상세 모달 */}
              <WordDetailModal 
                selectedWord={selectedWord} 
                onClose={() => setSelectedWord(null)} 
              />
            </div>
          );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>

    <script>
        // PWA Manifest와 Service Worker를 인라인으로 처리하여 단일 파일로 동작하도록 설정

        // 1. Manifest 파일 역할을 하는 Blob 생성 및 URL 설정
        const manifestData = {
          "name": "시편 119편 히브리어 학습",
          "short_name": "시편119",
          "description": "시편 119편 히브리어 단어별 학습 앱",
          "start_url": "./psalm119_pwa_single.html", // 이 파일의 이름으로 변경
          "display": "standalone",
          "background_color": "#F9FAFB",
          "theme_color": "#4F46E5",
          "orientation": "portrait",
          "icons": [
            {
              "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' fill='%234F46E5'/%3E%3Ctext x='256' y='380' font-size='280' text-anchor='middle' fill='white'%3E📖%3C/text%3E%3C/svg%3E",
              "sizes": "512x512",
              "type": "image/svg+xml",
              "purpose": "any maskable"
            }
          ]
        };
        const manifestBlob = new Blob([JSON.stringify(manifestData)], {type: 'application/json'});
        const manifestUrl = URL.createObjectURL(manifestBlob);
        document.getElementById('manifest-pwa').setAttribute('href', manifestUrl);

        // 2. Service Worker 인라인 정의 및 등록
        const swCode = `
            const CACHE_NAME = 'psalm119-v2';
            const urlsToCache = [
                './psalm119_pwa_single.html', // 이 파일 자체를 캐시
                // 외부 라이브러리도 캐시하려면 여기에 추가해야 합니다.
            ];

            // 설치: 캐시 파일 목록에 필요한 리소스를 저장
            self.addEventListener('install', event => {
              event.waitUntil(
                caches.open(CACHE_NAME)
                  .then(cache => cache.addAll(urlsToCache))
                  .catch(err => console.error('Service Worker Install Error:', err))
              );
            });

            // 활성화: 이전 버전 캐시 정리
            self.addEventListener('activate', event => {
              event.waitUntil(
                caches.keys().then(cacheNames => {
                  return Promise.all(
                    cacheNames.map(cacheName => {
                      if (cacheName !== CACHE_NAME) {
                        return caches.delete(cacheName);
                      }
                    })
                  );
                })
              );
            });

            // 요청 가로채기: 네트워크 연결이 없을 때 캐시된 리소스로 응답
            self.addEventListener('fetch', event => {
              // PWA 설치를 위해 메인 HTML 파일만 캐시에서 로드하도록 단순화
              if (event.request.url.includes('psalm119_pwa_single.html')) {
                event.respondWith(
                    caches.match(event.request)
                      .then(response => response || fetch(event.request))
                );
              }
            });
        `;

        const swBlob = new Blob([swCode], { type: 'application/javascript' });
        const swUrl = URL.createObjectURL(swBlob);

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register(swUrl)
                    .then(reg => {
                        console.log('Service Worker 등록 성공:', reg.scope);
                        // Service Worker가 등록되면 PWA 설치 프롬프트가 더 잘 작동합니다.
                    })
                    .catch(err => console.log('Service Worker 등록 실패:', err));
            });
        }
    </script>
</body>
</html>
